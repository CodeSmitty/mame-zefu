import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  async connect() {
    await this.toggleFavorite(this.element);
    console.log(this.element)
  }

  async toggleFavorite(element) {
    debugger;
    console.log(element)
    this.element.addEventListener('click', async (e) => {
      e.preventDefault();
      const url = "<%= toggle_favorite_recipe_path(recipe) %>"; // Use Ruby code to generate the URL
      console.log(url);
      try {
        const response = await fetch(url, { method: "POST" });
        if (!response.ok) throw new Error("Failed to toggle favorite");

        const data = await response.json();
        console.log(data);
        this.element.innerHTML = data.is_favorite ? "<%= escape_javascript(render('icons/mini/heart')) %>" : "<%= escape_javascript(render('icons/mini/empty_heart')) %>";
      } catch (error) {
        console.error(error);
      }
    });
  }
}
